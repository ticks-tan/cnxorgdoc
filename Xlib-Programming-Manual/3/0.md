# 基本窗口程序

每个 Xlib 程序都有一个类似的结构。本章将展示一个简单的程序，它可以创建一个窗口并处理该窗口中的事件。你可以用这个简单的程序作为你自己更复杂的应用程序的模板。

本章在介绍一个简单程序的同时，还会演示用X库编程的基本原理。所有客户端都将使用这里描述和演示的技术。

本章介绍的基本程序满足了 **第2章 "X概念"** 末尾概述的基本应用程序的所有要求，并说明了一些最重要的X概念和编程问题。在继续学习之前，你应该已经阅读了 **第2章 "X概念"** 。

该程序将执行如下操作：

- 用 **`XOpenDisplay()`** 将客户端连接到X服务器，如果不能建立连接，则优雅地退出。
- 获取有关物理屏幕的信息，并利用它来计算所需的窗口尺寸。
- 用 **`XCreateSimpleWindow()`** 创建一个窗口。
- 为窗口管理器设置标准属性。
- 选择窗口需要接收的事件类型。
- 加载用于打印文本的字体。
- 创建一个图形上下文来控制绘图请求。
- 用 **`XMapWindow()`** 映射该窗口。
- 进入事件循环。
- 响应由映射窗口产生的 **Expose** 事件（以及随后可能出现的任何其他 **Expose** 事件），调用函数来绘制文本和图形。如果窗口太小，无法执行其预期的功能，它将显示一个适当的消息。
- 接收 **ConfigureNotify** 事件，表明窗口被窗口管理器调整大小。新的窗口大小在事件结构体中提供。
- 继续处理事件，直到一个 **KeyPress** 或 **ButtonPress** 事件到来，然后关闭显示连接并退出。

该程序不执行以下操作，不过这些操作是一个强大的X客户端需要实现的：

- 允许用户指定命令行选项并读取资源数据库。
- 主题自定义。
- 错误处理。

关于这些主题的更多信息，在 **第7章 "颜色"** 和 **第14章 "完整的应用"** 会进一步描述。

---

#### [上一章](../2/0.md)

#### [下一节](./1.md)


