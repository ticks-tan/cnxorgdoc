# 更多的窗口特性

本节将对 **第2.2.1节 ”窗口特征“** 中的窗口特征概述进行扩展，并更详细地描述窗口属性、窗口配置、类别以及深度和视觉。

## 窗口属性

窗口属性包含一个窗口的外观和行为的信息。每个窗口都有一套单独的属性，可以用 **`XChangeWindowAttributes()`** 来设置，或者在某些情况下，用只改变其单个属性的函数来设置。这些属性可以控制以下窗口功能：

- **Background：** 可以是纯色、平铺的像素图，也可以是透明的。
- **Border：** 可以是纯色或平铺的像素图。
- **Bit Gravity：** 决定当一个窗口被调整大小时如何保留部分窗口内容。
- **Window Gravity：** 决定当一个窗口被调整大小时，如何重新定位子窗口。
- **Backing Store：** 提供提示，在窗口未被映射或被遮挡时，何时应自动保存窗口的内容，哪些显示部分应被保存，以及在恢复未保存的部分时应使用什么像素值。并非所有的服务器都能进行备份。可以通过检查 **`DoesBackingStore()`** 宏返回的值，来确定你的服务器上的某个特定屏幕是否支持这一功能。
- **Saving Under：** 提供提示，说明在一个窗口（如弹出式菜单）存在时，是否应该保存窗口下的屏幕区域，以避免在弹出式菜单被移除时，被遮挡的窗口不得不重新进行绘制。并非所有的服务器都能保存窗口下的内容。你可以通过 **`DoesSaveUnders()`** 宏来了解某个特定屏幕是否支持这一功能。
- **Events：** 指明哪些事件应该被接收，哪些事件不应该被发送到祖先窗口。
- **Substructure Redirect：** 覆盖确定是否应该允许此窗口在屏幕上被映射而不被窗口管理器干预。这种覆盖通常用于菜单和其他经常被映射的窗口，然后很快被取消映射。
- **Colormap：** 确定该窗口应使用哪种虚拟颜色映射。
- **Cursor：** 决定当指针在这个窗口中时应该显示哪个光标。

描述一下窗口属性不影响的功能，可能会使情况更清楚。**设置窗口属性并不决定一个窗口的大小或位置、它的父级、或它的边界宽度，这些属于窗口的配置（Window Configuration）** 。设置窗口属性并不影响窗口的深度、等级或视觉，这些在窗口创建时被永久地设置了。窗口属性不决定如何解释图形请求，这是图形上下文（GC）的工作。

## 窗口配置（Window Configuration）

一个窗口的配置包括它的位置、宽度和高度、边框宽度和堆叠位置。这些因素的处理方式与窗口属性不同（尽管它们在内部存储在 **XWindowAttributes** 结构体中），一个重要原因是：**改变顶级窗口（根窗口的子窗口）的配置必须与窗口管理器合作进行** 。

在这里我们不会详细讨论当试图映射一个窗口或改变一个窗口配置时，应用程序必须如何与窗口管理器进行交互。现在，我们只需要说，有一些规则是应用程序必须遵循的，以便窗口管理器能够负责控制屏幕上的内容和位置。关于客户端与窗口管理器交互的介绍，在 **第3章 "基本窗口程序"** 会介绍，更完整的描述在 **第12章 "客户端之间的通信"** 。

## 输入输出窗口与仅输入窗口（InputOutput and InputOnly Window）

X 窗口系统提供了两类窗口：**`InputOutput`** 和 **`InputOnly`** 。这两个类的主要区别是，**`InputOnly`** 窗口不能被用作 **drawable** 。因此，**`InputOnly`** 窗口的窗口属性有一些限制，没有边框和透明背景，并且子窗口不能是 **`InputOutput`** 窗口。

**`InputOnly`** 窗口在屏幕上形成一个不可见的区域，在这个区域，输入有不同的目的，但显示不会改变。**`InputOnly`** 窗口通常使用一个不同的光标来区分其他类型窗口，**`InputOnly`** 窗口很少被使用。

需要注意，**窗口的类别在创建时被指定，不能在创建后改变** 。

## 深度和视觉（Depth and Visual）

窗口的深度和视觉是在创建时指定的，不能在创建后改变。深度是用来表示窗口内灰度或颜色的平面数（深度也是每个像素的比特数）。一个 **`InputOutput`** 窗口所允许的最大深度是与之相关的屏幕所支持的平面数。如果一个屏幕有12个平面，一个窗口每个像素最多可以有12个比特，因此最多可以有 $2^{12}$ 种不同的灰度或颜色。

**`InputOnly`** 窗口的深度始终为 `0` ，对于 **`InputOutput`** 窗口，在 **`XCreateWindow()`** 的深度参数中使用 **`CopyFromParent`** 时会复制父窗口的深度，大多数窗口的默认深度是从根窗口继承的。

在确定像素值转化为特定窗口内的可见颜色的方式时，视觉（Visual）说明了各种不同类型的显示硬件之间的差异。一个屏幕可能只支持一种或几种类型的视觉。**`XVisualInfo`** 结构包含了一个特定视觉的所有信息。**`XVisualInfo`** 的一个成员是视觉类（Visual class），它是 **`DirectColor`** 、 **`GrayScale`** 、**`PseudoColor`** 、**`StaticColor`** 、**`StaticGray`** 或 **`TrueColor`** 中的一个值。这些值指定了可以与窗口一起使用的颜色映射表的特性（颜色映射表是只读还是可读/可写，彩色还是单色，分成三原色还是复合色）。**`XVisualInfo`** 的其他成员指定了像素值的有效范围（像素的哪些位被分配给红色、绿色和蓝色），以及其他几个变量。

**当用 `XCreateSimpleWindow()` 创建一个窗口时，其深度和视觉都是从父窗口继承的** 。关于视觉类的更多信息，将在 **第7章 "颜色"** 中讲解。

## 图标化（Icons）

图标是一个的窗口标记，表示一个较大的 "主" 窗口存在并可用，但目前没有映射到屏幕上。

大多数窗口管理程序允许用户在不破坏程序的情况下将其图标化，以使其不显示在屏幕上（可以看作后台运行）。解除一个应用程序的图标比重新开始运行该应用程序更快、更方便。而且，被图标化的应用程序会继续运行它在图标化时正在工作的任何进程（除非应用程序被编程为在图标化时停止）。当需要输入时，程序可以等待，直到窗口被取消图标或允许图标中的输入。

**图2-4** 显示了一个 Xterm 窗口被图标化前和图标化后的情况。Xterm 应用程序并没有创建一个图标像素图，因此，窗口管理器只是把它的图标名称画到图标中。在不同的窗口管理器中，图标的外观和位置是不同的。

图 2-4：

![图2-4](./Figures/Figure-2-4.svg)

图标窗口由窗口管理器管理，在大多数情况下，由窗口管理器创建。通过窗口管理器的提示，一个应用程序传递其图标名称和像素图，以便在图标窗口中显示。如果一个应用程序需要对它自己的图标窗口进行操作（也许是为了能够随时改变背景，就像邮件处理程序 xmh 那样，通过图标颜色改变表明邮件已经到达），它可以创建自己的图标窗口并将窗口 ID 传递给窗口管理器。否则，窗口管理器将为其创建图标窗口。窗口管理器可以在根窗口的一个属性中指定它更喜欢什么尺寸的图标像素图。如果这个属性被设置了，应用程序应该尝试提供一个窗口管理器可接受尺寸的图标像素图。

## 根窗口的特殊性

根窗口在X服务器程序被初始化时被创建，其窗口特征与其他窗口的特征略有不同。

根窗口是一个 **`InputOutput`** 窗口，它总是被映射的，它的大小不能被改变，它的左上角总是在屏幕的左上角，那里的全局坐标是 `(0,0)` 。根窗口有一个零宽度的窗口边框，其大小可以通过 **第三章 "基本窗口程序"** 中描述的宏来访问。

根窗口的默认窗口属性包括一个带有对角线交叉阴影的背景像素图、默认的颜色映射和一个大 X 的默认光标。事件屏蔽属性可以改变，但默认情况下，根窗口中发生的事件不会被发送到任何客户端。其他的属性都不适用于根窗口。关于设置窗口属性的更多信息，可以参考 **第4章 "窗口属性"** 。

**根窗口永远不会被窗口管理程序图标化，因为除其他原因外，它不能被取消映射 。**  

---

#### [上一节](./3.md)

#### [下一节](./5.md)

